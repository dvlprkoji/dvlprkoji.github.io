<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="스프링 테스트(test)" /><meta property="og:locale" content="en" /><meta name="description" content="어떤 기능을 테스트 할 때 고려할 사항이 몇 가지 존재한다 하나하나 살펴보자 작은 단위의 테스트" /><meta property="og:description" content="어떤 기능을 테스트 할 때 고려할 사항이 몇 가지 존재한다 하나하나 살펴보자 작은 단위의 테스트" /><link rel="canonical" href="https://dvlprkoji.github.io/posts/spring-test/" /><meta property="og:url" content="https://dvlprkoji.github.io/posts/spring-test/" /><meta property="og:site_name" content="Koji’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-30T09:00:01+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="스프링 테스트(test)" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-11-30T15:43:39+09:00","datePublished":"2021-11-30T09:00:01+09:00","description":"어떤 기능을 테스트 할 때 고려할 사항이 몇 가지 존재한다 하나하나 살펴보자 작은 단위의 테스트","headline":"스프링 테스트(test)","mainEntityOfPage":{"@type":"WebPage","@id":"https://dvlprkoji.github.io/posts/spring-test/"},"url":"https://dvlprkoji.github.io/posts/spring-test/"}</script><title>스프링 테스트(test) | Koji's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Koji's Blog"><meta name="application-name" content="Koji's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn-icons-png.flaticon.com/512/822/822123.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Koji's Blog</a></div><div class="site-subtitle font-italic">Backend Develeoper</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/dvlprkoji" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['koji4321','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>스프링 테스트(test)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>스프링 테스트(test)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> koji </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 30, 2021, 9:00 AM +0900" >Nov 30, 2021<i class="unloaded">2021-11-30T09:00:01+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 30, 2021, 3:43 PM +0900" >Nov 30, 2021<i class="unloaded">2021-11-30T15:43:39+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3499 words">19 min read</span></div></div><div class="post-content"><p>어떤 기능을 테스트 할 때 고려할 사항이 몇 가지 존재한다 하나하나 살펴보자</p><h2 id="작은-단위의-테스트">작은 단위의 테스트</h2><p>어떤 기능을 개발할 때 높은 응집도를 가지는 것이 좋다고 했다 테스트를 작성할 때에도 동일하게 관심사의 분리가 이루어져야 한다 테스트의 관심이 다르다면 테스트할 대상을 분리하고 집중해서 접근해야 한다</p><p>이렇게 작은 단위의 코드에 대해 테스트를 수행한 것을 단위 테스트(Unit Test)라고 한다 여기서 말하는 단위는 정해진 것이 아니며, 하나의 관심에 집중해 효율적으로 테스트 할 수 있는 범위의 단위로 보면 된다</p><h2 id="자동수행-테스트">자동수행 테스트</h2><p>테스트를 진행할 때 웹 화면에 폼을 띄운 뒤 매번 값을 입력하고 클릭하는 과정을 반복하면 효율성이 저하될 것이다 자바 코드로만 작성되어 자동으로 수행되는 테스트의 경우 코드의 수정이 발생해도 빠르게 테스트를 실행할 수 있다</p><h2 id="지속적-개선과-점진적-개발을-위한-테스트">지속적 개선과 점진적 개발을 위한 테스트</h2><p>각 기능들에 대해 테스트를 작성하면서 코드를 작성하면 나중에 설계 오류가 발견되는 상황에서도 어떤 부분에 문제가 발생했는지 확신을 가지고 찾아낼 수 있게 된다</p><p>또 기능을 추가하려고 해도 미리 만들어 놓은 테스트 코드는 유용하다 새로운 기능을 추가한다고 해도 기존에 만들어뒀던 기능들이 수정한 코드에 영향을 받지 않고 동작하는 것을 확인할 수 있다</p><h2 id="userdaotest의-문제점">UserDaoTest의 문제점</h2><p>여기 이전 spring IoC 를 학습하기 위해 작성한 테스트 코드가 있다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
      <span class="nc">ApplicationConext</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>
      <span class="nc">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

      <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"안재홍"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"developer"</span><span class="o">);</span>

      <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 등록 성공"</span><span class="o">);</span>

      <span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 조회 성공"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이 테스트 방법은 main 메소드를 사용하였고, Application Context를 생성하여 UserDao 객체를 직접 호출했다 하지만 이 코드에는 여러 문제점들이 존재한다</p><h3 id="수동-확인-작업의-번거로움">수동 확인 작업의 번거로움</h3><p>위 코드에서 입력과 출력 과정은 자동으로 진행되었으나 그 값을 검증하는 것은 개발자의 몫이다</p><h3 id="실행-작업의-번거로움">실행 작업의 번거로움</h3><p>만약 테스트의 개수가 증가하면, 단순히 main메소드로 확인하기에는 번거로움이 발생한다</p><h2 id="userdaotest-개선">UserDaoTest 개선</h2><p>UserDaoTest의 두 가지 문제점을 개선해 보자</p><h3 id="테스트-검증의-자동화">테스트 검증의 자동화</h3><p>첫 번째 문제점인 테스트 결과의 검증 부분을 코드로 만들어 보자</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
      <span class="nc">ApplicationConext</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>
      <span class="nc">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

      <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"안재홍"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"developer"</span><span class="o">);</span>

      <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 등록 성공"</span><span class="o">);</span>

      <span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>

      <span class="c1">// System.out.println(user2.getId() + " 조회 성공");</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">()))</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"테스트 실패 (name)"</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">else</span> <span class="nf">if</span> <span class="o">(!</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()))</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"테스트 실패 (password)"</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"조회 테스트 성공"</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이제 검증이 완벽히 자동화 되었다 테스트를 실행하고 단순히 성공 메시지만 확인하면 될 것이다</p><p>이제 다음 문제를 해결해 보자 main 메소드가 아닌 JUnit 테스팅 프레임워크는 일정한 패턴을 가진 테스트를 만들 수 있고, 많은 테스트를 간단히 실행시킬 수 있으며, 테스트 결과를 종합적으로 볼 수 있고, 테스트가 실패한 곳을 빠르게 찾을 수 있다</p><h3 id="junit-테스트로-전환">Junit 테스트로 전환</h3><p>기존의 main 메소드는 제어권을 직접 갖는다 JUnit은 테스팅을 위한 프레임워크고 프레임워크는 제어 권한을 넘겨받아 주도적으로 애플리케이션 흐름을 제어한다 따라서 JUnit을 사용하면 main 메소드도 필요 없고 오브젝트를 만들어 실행할 필요도 없어진다</p><p>이제 main 메소드를 제거하고 Junit의 메소드로 변경해 보자 Junit은 테스트 메소드가 따라야 할 조건을 두 가지 설정해 놓았는데 첫 번째는 public으로 선언되어야 하는 것이고, 다른 하나는 @Test라는 어노테이션을 붙여주는 것이다 이를 만족하도록 코드를 수정해 보겠다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAndGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
      <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>

      <span class="nc">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="o">...</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이제 테스트 코드의 결과를 검증하는 if/else 문을 Junit이 제공하는 방법으로 전환해 보겠다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAndGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
      <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>

      <span class="nc">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"안재홍"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">"koji4321"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"springno1"</span><span class="o">);</span>

      <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

      <span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

      <span class="n">assertThat</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()));</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 JUnit을 이용하도록 테스트 코드를 수정하였다 하지만 이 코드에도 문제가 있다 UserDaoTest의 문제는 이전 테스트 때문에 DB에 등록된 중복 데이터가 있을 수 있다는 점이다 가장 좋은 해결책은 addAndGet() 테스트를 마치고 나면 테스트가 등록한 사용자 정보를 삭제하는 것이다 User 테이블의 모든 레코드를 삭제하는 deleteAll 메소드를 작성해 보자</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">Connection</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>

        <span class="nc">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">preparedStatement</span><span class="o">(</span><span class="s">"delete from users"</span><span class="o">);</span>
        <span class="n">ps</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>

        <span class="n">ps</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">c</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>그리고 삭제 확인을 위해 레코드 개수를 확인하는 getCount 메소드를 작성해 보자</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">Connection</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>

        <span class="nc">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">preparedStatement</span><span class="o">(</span><span class="s">"select count(*) from users"</span><span class="o">);</span>
        <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
        <span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

        <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">ps</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">c</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이제 테스트 코드에서 작성한 기능들을 사용해보자</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAndGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
      <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>
      <span class="nc">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

      <span class="n">dao</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">dao</span><span class="o">.</span><span class="na">getCount</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>

      <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"안재홍"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">"koji4321"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"springno1"</span><span class="o">);</span>

      <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">dao</span><span class="o">.</span><span class="na">getCount</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>

      <span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

      <span class="n">assertThat</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()));</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이제 몇 번을 실행하더라도 동일한 결과를 보장할 수 있게 되었다 하지만 만약, get 메서드의 입력값에 존재하지 않는 id값이 입력되면 어떻게 될까 추가적으로 get 메서드의 입력값에 대한 예외조건을 처리하기 위해 @Test 어노테이션의 파라미터를 지정해 줄 수 있다 테스트 중에 발생할 것으로 기대하는 예외 클래스를 지정하면 정상적으로 동작할 것이다 또한 get 메서드에서도 예외가 발생할 것이므로 이를 밖으로 던져 주도록 수정해야 할 것이다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
  <span class="nd">@Test</span><span class="o">(</span><span class="n">expected</span><span class="o">=</span><span class="nc">EmptyResultDataAccessException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getUserFailure</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
      <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>
      <span class="nc">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="n">userDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

      <span class="n">dao</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">dao</span><span class="o">.</span><span class="na">getCount</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>

      <span class="n">dao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"unknown_id"</span><span class="o">);</span>    <span class="c1">// 오류 발생 지점</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span><span class="o">{</span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">get</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>

        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">name</span><span class="o">));</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">password</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">ps</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">c</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyResultDataAccessException</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이제 정말 정상적으로 동작되는 코드가 작성되었다 이제 JUnit 프레임워크가 제공하는 다양한 기능들을 사용하여 성능을 향상시키고, 단순화를 시켜 보자</p><p>먼저 UserDaoTest의 코드를 살펴 보면, 중복되는 코드가 존재한다 ApplicationContext를 생성하고 UserDao 빈을 받아오는 과정이 중복된다 JUnit에는 중복된 과정을 생략할 수 있도록 @Before 어노테이션을 제공한다 이를 활용하면 다음과 같이 작성할 수 있다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">UserDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>
      <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAndGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"안재홍"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">"koji4321"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"springno1"</span><span class="o">);</span>

        <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

        <span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

        <span class="n">assertThat</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()));</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>JUnit이 하나의 테스트 클래스를 가져와 테스트를 수행하는 방식은 다음과 같다</p><ol><li>테스트 클래스에서 @Test가 붙은 public이고 void형이며 파라미터가 없는 메서드를 모두 찾는다<li>테스트 클래스의 오브젝트를 하나 만든다<li>@Before이 붙은 메서드를 실행한다<li>@Test가 붙은 메소드를 하나 호출하고 테스트 결과를 저장한다<li>@After이 붙은 메서드가 있으면 실행한다<li>나머지 메서드에 대해 2~5를 반복한다<li>테스트 결과를 종합해 돌려준다</ol><p>테스트 코드에서 필요한 정보나 오브젝트를 픽스쳐(Fixture)라고 한다 일반적인 픽스쳐는 여러 테스트에서 반복 사용되므로 @Before 메서드를 이용해 생성해 두면 편하다 UserDaoTest 클래스에서 픽스쳐는 UserDao, User가 해당된다 이제 해당 픽스쳐를 미리 선언해놓고 @Before 메서드를 통해 초기화를 시켜 보자</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">UserDao</span> <span class="n">dao</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">User</span> <span class="n">user1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">User</span> <span class="n">user2</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">User</span> <span class="n">user3</span><span class="o">;</span>


    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span>
        <span class="n">dao</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">this</span><span class="o">.</span><span class="na">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"koji"</span><span class="o">,</span> <span class="s">"안재홍"</span><span class="o">,</span> <span class="s">"spingno1"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"panda"</span><span class="o">,</span> <span class="s">"오승주"</span><span class="o">,</span> <span class="s">"kubernetesno1"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"bdj"</span><span class="o">,</span> <span class="s">"배동준"</span><span class="o">,</span> <span class="s">"displayno1"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAndGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span>

        <span class="nc">User</span> <span class="n">findUser</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">user1</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

        <span class="n">assertThat</span><span class="o">(</span><span class="n">findUser</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">findUser</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()));</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이제 ApplicationContext의 생성 방식을 변경해 보자 지금까지는 매 테스트마다 ApplicationContext를 생성했다 각 테스트는 독립된 상황에서 독립적인 오브젝트를 사용하는 것이 원칙이나, 생성에 시간과 자원이 많이 소모되는 경우, 테스트 전체가 공유하는 오브젝트를 만들기도 한다 ApplicationContext는 초기화된 후 변경되는 일이 없고, 각 빈은 싱글톤 방식으로 생성되어 stateless 상태이다 따라서 이 ApplicationContext를 여러 테스트에서 공유하도록 작성할 수 있다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">"/applicationContext.xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ApplicationContext</span> <span class="n">context</span><span class="o">;</span>

    <span class="o">...</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dao</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"userDao"</span><span class="o">,</span> <span class="nc">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>@ContextConfiguration 어노테이션에 지정한 설정 파일을 읽어서 초기화하는 과정을 진행했다 하지만 우리가 작성한 applicationContext.xml에는 ApplicationContext에 관련된 빈이 존재하지 않는데 어떻게 된 것일까 ApplicationContext는 초기화할 때 자기 자신도 빈으로 등록한다 따라서 해당 빈이 존재하고 DI도 가능해진 것이다</p><p>그렇다면 굳이 ApplicationContext를 DI받지 않고, UserDao빈을 DI받으면 되지 않을까?</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">"/applicationContext.xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">UserDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="o">...</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 DI가 완료된 UserDao를 가지게 되었다 여기서 @Autowired는 변수에 할당 가능한 타입을 가진 빈을 자동으로 찾는다 만약 타입이 여러 개인 경우 CamelCase를 적용하여 동일한 이름을 가진 빈을 주입한다</p><p>이제 얼추 해결 된 듯 보이지만, 아직 문제가 남아 있다 지금까지 사용한 DB가 운영용 DB라고 생각하면, 이를 가지고 테스트를 진행할 수는 없을 것이다 따라서 새로운 테스트용 DB를 사용하는 것이 필요한데, 이는 새로운 컨테이너 설정 파일을 사용하는 것으로 해결이 가능하다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">"/test-applicationContext.xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이번 포스팅에서 알아본 것들을 총 정리하면 다음과 같다</p><ul><li>테스트는 자동화되어야 하고, 빠르게 실행할 수 있어야 한다<li>main()테스트 대신 JUnit 프레임워크를 이용한 테스트 작성이 편리하다<li>테스트 결과는 일관성이 있어야 한다. 코드의 변경 없이 환경이나 실행 순서에 무관하게 실행되어야 한다<li>테스트는 포괄적으로 작성해야 한다. 충분한 검증을 하지 않는 테스트는 없는 것보다 나쁘다<li>코드 작성과 테스트 수행 사이의 간격이 짧을수록 효과적이다<li>테스트하기 쉬운 코드가 좋은 코드다<li>테스트를 만들고 테스트를 성공시키도록 코드를 작성하는 TDD도 유효한 개발방법이다<li>테스트 코드 또한 리팩토링이 필요하다<li>@Before, @After를 사용해서 테스트 메소드들의 공통 준비 작업과 정리 작업을 처리할 수 있다<li>스프링 테스트 컨텍스트 프레임워크를 사용하면 성능을 향상할 수 있다<li>동일한 설정파일을 사용하는 테스트는 하나의 ApplicationContext를 공유한다</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/test/'>Test</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/test/" class="post-tag no-text-decoration" >test</a> <a href="/tags/junit/" class="post-tag no-text-decoration" >junit</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=스프링 테스트(test) - Koji's Blog&url=https://dvlprkoji.github.io/posts/spring-test/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=스프링 테스트(test) - Koji's Blog&u=https://dvlprkoji.github.io/posts/spring-test/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=스프링 테스트(test) - Koji's Blog&url=https://dvlprkoji.github.io/posts/spring-test/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/spring-batch/">스프링 배치(Spring Batch) - 1. 스프링 배치 시작</a><li><a href="/posts/java-threadlocal/">자바 쓰레드 로컬(ThreadLocal)</a><li><a href="/posts/develop-oop/">객체 지향 설계 (OOP, Object Oriented Programming)</a><li><a href="/posts/spring-test/">스프링 테스트(test)</a><li><a href="/posts/dictionary/">객체 지향 설계의 5가지 원칙(OOP, Object Oriented Programming)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/batch/">batch</a> <a class="post-tag" href="/tags/comparable/">comparable</a> <a class="post-tag" href="/tags/comparator/">comparator</a> <a class="post-tag" href="/tags/servlet-container/">servlet container</a> <a class="post-tag" href="/tags/spring-container/">spring container</a> <a class="post-tag" href="/tags/spring-security/">spring security</a> <a class="post-tag" href="/tags/abstract-class/">abstract class</a> <a class="post-tag" href="/tags/abstract-method/">abstract method</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-template/"><div class="card-body"> <span class="timeago small" >Dec 1, 2021<i class="unloaded">2021-12-01T09:00:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>예제로 알아보는 스프링 템플릿(Template), 콜백(Callback)</h3><div class="text-muted small"><p> 이전에 작성했던 DB 커넥션 코드들 중 UserDao의 가장 단순한 메서드인 deleteAll()를 살펴보자 1 2 3 4 5 6 7 8 9 10 11 public class UserDao{ public void deleteAll() throws SQLException{ Connection c = dataSource.getConnect...</p></div></div></a></div><div class="card"> <a href="/posts/spring-service-abstraction/"><div class="card-body"> <span class="timeago small" >Dec 2, 2021<i class="unloaded">2021-12-02T09:00:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 서비스 추상화(Service Abstraction)</h3><div class="text-muted small"><p></p></div></div></a></div><div class="card"> <a href="/posts/spring-container/"><div class="card-body"> <span class="timeago small" >Jun 6<i class="unloaded">2023-06-06T09:00:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 컨테이너와 서블릿 컨테이너</h3><div class="text-muted small"><p> 웹 개발자라면 스프링 컨테이너와 서블릿 컨테이너에 대해 어느 정도는 알고 있을 것이다. 나도 딱 어느정도만 알고 있고, 실무에서 직접적으로 다루지는 않다 보니 공부를 해도 금세 휘발되어 버린다. 웹개발자라면 컨테이너, 스프링 컨테이너, 서블릿 컨테이너에 대해 언제나 설명할 수 있어야 한다고 생각하기에 정리해본다. 서블릿이란? 서블릿(Servl...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-singleton/" class="btn btn-outline-primary" prompt="Older"><p>스프링 싱글톤(Singleton)</p></a> <a href="/posts/spring-exception/" class="btn btn-outline-primary" prompt="Newer"><p>스프링 예외(Exception)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/dvlprkoji">koji</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/batch/">batch</a> <a class="post-tag" href="/tags/comparable/">comparable</a> <a class="post-tag" href="/tags/comparator/">comparator</a> <a class="post-tag" href="/tags/servlet-container/">servlet container</a> <a class="post-tag" href="/tags/spring-container/">spring container</a> <a class="post-tag" href="/tags/spring-security/">spring security</a> <a class="post-tag" href="/tags/abstract-class/">abstract class</a> <a class="post-tag" href="/tags/abstract-method/">abstract method</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dvlprkoji.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
