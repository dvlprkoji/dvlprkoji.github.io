<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor)" /><meta property="og:locale" content="en" /><meta name="description" content="서블릿 필터? 스프링 인터셉터? 웹 어플리케이션을 개발하다 보면 로그인 처리와 같이 대부분의 로직에서 공통으로 적용해야 할 기능들이 존재한다 이렇게 애플리케이션 로직에서 공통으로 관심이 있는 것을 공통 관심사(cross-cutting concern)라고 한다 이러한 공통 관심사는 Spring의 AOP를 통해 구현이 가능하지만, 로직의 복잡성이 증가할 뿐만 아니라 향후 이와 관련된 로직이 변경되면 작성한 모든 로직을 수정해야 할 것이다 따라서 웹과 관련된 공통 관심사는 지금부터 알아볼 서블릿 필터나 스프링 인터셉터를 사용하는 것이 좋다 웹과 관련된 공통 관심사를 처리할 때는 HTTP의 헤더나 URL의 정보들이 필요한데, 서블릿 필터나 스프링 인터셉터는 HttpServletRequest를 제공한다" /><meta property="og:description" content="서블릿 필터? 스프링 인터셉터? 웹 어플리케이션을 개발하다 보면 로그인 처리와 같이 대부분의 로직에서 공통으로 적용해야 할 기능들이 존재한다 이렇게 애플리케이션 로직에서 공통으로 관심이 있는 것을 공통 관심사(cross-cutting concern)라고 한다 이러한 공통 관심사는 Spring의 AOP를 통해 구현이 가능하지만, 로직의 복잡성이 증가할 뿐만 아니라 향후 이와 관련된 로직이 변경되면 작성한 모든 로직을 수정해야 할 것이다 따라서 웹과 관련된 공통 관심사는 지금부터 알아볼 서블릿 필터나 스프링 인터셉터를 사용하는 것이 좋다 웹과 관련된 공통 관심사를 처리할 때는 HTTP의 헤더나 URL의 정보들이 필요한데, 서블릿 필터나 스프링 인터셉터는 HttpServletRequest를 제공한다" /><link rel="canonical" href="https://dvlprkoji.github.io/posts/spring-filter/" /><meta property="og:url" content="https://dvlprkoji.github.io/posts/spring-filter/" /><meta property="og:site_name" content="Koji’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-28T09:00:01+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor)" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-28T09:00:01+09:00","datePublished":"2021-09-28T09:00:01+09:00","description":"서블릿 필터? 스프링 인터셉터? 웹 어플리케이션을 개발하다 보면 로그인 처리와 같이 대부분의 로직에서 공통으로 적용해야 할 기능들이 존재한다 이렇게 애플리케이션 로직에서 공통으로 관심이 있는 것을 공통 관심사(cross-cutting concern)라고 한다 이러한 공통 관심사는 Spring의 AOP를 통해 구현이 가능하지만, 로직의 복잡성이 증가할 뿐만 아니라 향후 이와 관련된 로직이 변경되면 작성한 모든 로직을 수정해야 할 것이다 따라서 웹과 관련된 공통 관심사는 지금부터 알아볼 서블릿 필터나 스프링 인터셉터를 사용하는 것이 좋다 웹과 관련된 공통 관심사를 처리할 때는 HTTP의 헤더나 URL의 정보들이 필요한데, 서블릿 필터나 스프링 인터셉터는 HttpServletRequest를 제공한다","headline":"Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor)","mainEntityOfPage":{"@type":"WebPage","@id":"https://dvlprkoji.github.io/posts/spring-filter/"},"url":"https://dvlprkoji.github.io/posts/spring-filter/"}</script><title>Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor) | Koji's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Koji's Blog"><meta name="application-name" content="Koji's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn-icons-png.flaticon.com/512/822/822123.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Koji's Blog</a></div><div class="site-subtitle font-italic">Backend Develeoper</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/dvlprkoji" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['koji4321','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> koji </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Sep 28, 2021, 9:00 AM +0900" >Sep 28, 2021<i class="unloaded">2021-09-28T09:00:01+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1775 words">9 min read</span></div></div><div class="post-content"><h1 id="서블릿-필터-스프링-인터셉터">서블릿 필터? 스프링 인터셉터?</h1><p>웹 어플리케이션을 개발하다 보면 로그인 처리와 같이 대부분의 로직에서 공통으로 적용해야 할 기능들이 존재한다<br /> 이렇게 애플리케이션 로직에서 공통으로 관심이 있는 것을 <strong>공통 관심사(cross-cutting concern)</strong>라고 한다<br /> 이러한 공통 관심사는 Spring의 AOP를 통해 구현이 가능하지만,<br /> 로직의 복잡성이 증가할 뿐만 아니라 향후 이와 관련된 로직이 변경되면 작성한 모든 로직을 수정해야 할 것이다 <br /><br /> 따라서 웹과 관련된 공통 관심사는 지금부터 알아볼 서블릿 필터나 스프링 인터셉터를 사용하는 것이 좋다 <br /> 웹과 관련된 공통 관심사를 처리할 때는 HTTP의 헤더나 URL의 정보들이 필요한데, <br /> 서블릿 필터나 스프링 인터셉터는 HttpServletRequest를 제공한다</p><h3 id="서블릿-필터-소개">서블릿 필터 소개</h3><p>서블릿 필터는 서블릿이 지원하는 수문장이다<br /> 필터의 특성은 다음과 같다 ####필터 흐름</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>HTTP 요청 -&gt; WAS -&gt; 필터 -&gt; 서블릿 -&gt; 컨트롤러
</pre></table></code></div></div><p>필터를 적용하면 필터가 호출 된 다음 서블릿이 호출된다<br /> 그래서 모든 고객의 요청 로그를 남기는 요구사항이 있다면 필터를 사용하면 된다</p><h4 id="필터-제한">필터 제한</h4><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>HTTP 요청 -&gt; WAS -&gt; 필터 -&gt; 서블릿 -&gt; 컨트롤러             // 인가 사용자 (로그인 Success)
HTTP 요청 -&gt; WAS -&gt; 필터 -&gt; X                            // 비인가 사용자 (로그인 Fail)
</pre></table></code></div></div><h4 id="필터-체인">필터 체인</h4><p>필터는 체인으로 구성되는데, 중간에 필터를 자유롭게 추가할 수 있다<br /> 예를 들어 로그를 남기는 필터를 먼저 적용하고, 그 다음에 로그인 여부를 체크하는 필터를 만들 수 있다</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>HTTP 요청 -&gt; WAS -&gt; 필터1 -&gt; 필터2 -&gt; 필터3 -&gt; 서블릿 -&gt; 컨트롤러        // 필터 체인
</pre></table></code></div></div><h4 id="필터-인터페이스">필터 인터페이스</h4><p>필터 인터페이스를 구현하고 등록하면, 서블릿 컨체이너가 필터를 싱글톤 객체로 생성하고, 관리한다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Filter</span><span class="o">{</span>
    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span>
                            <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span>
                            <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span><span class="o">;</span>
    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">init()</code> : 필터 초기화 메서드<li><code class="language-plaintext highlighter-rouge">doFilter()</code>: 고객의 요청이 올 때마다 해당 메서드가 호출된다<li><code class="language-plaintext highlighter-rouge">destroy()</code> : 필터 종료 메서드, 서블릿 컨테이너가 종료될 때 호출된다 <br /><br /></ul><h3 id="필터의-사용">필터의 사용</h3><p>서비스 접근 로그를 남기는 필터를 작성하고 적용해 보겠다<br /> 먼저 로그 필터를 작성해 보자</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Filter Initialize"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span>
                         <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span>
                         <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span><span class="o">{</span>
        
        <span class="nc">HttpServletRequest</span> <span class="n">httpRequest</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span><span class="n">request</span><span class="o">;</span>
        <span class="nc">HttpServletResponse</span> <span class="n">httpResponse</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span><span class="n">response</span><span class="o">;</span>
        
        <span class="nc">String</span> <span class="n">randomUUID</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Request [{}][{}]"</span><span class="o">,</span> <span class="n">httpRequest</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">,</span> <span class="n">randomUUID</span><span class="o">);</span>
            <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">finally</span><span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Response [{}][{}]"</span><span class="o">,</span> <span class="n">httpResponse</span><span class="o">.</span><span class="na">getResponseURI</span><span class="o">,</span> <span class="n">randomUUID</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Filter Destroy"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이제 작성한 필터를 등록해 보자<br /> 우리는 Spring Boot를 사용하기 때문에 FilterRegistrationBean을 생성해 사용하면 된다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span><span class="o">{</span>
    
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">FilterRegistrationBean</span> <span class="nf">logFilter</span><span class="o">(){</span>
        <span class="nc">FilterRegistrationBean</span> <span class="n">filterRegistrationBean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilterRegistrationBean</span><span class="o">&lt;&gt;();</span>
        <span class="n">filterRegistrationBean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="nc">Logfilter</span><span class="o">());</span>
        <span class="n">filterRegistrationBean</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">filterRegistrationBean</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">"/*"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">filterRegistrationBean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이제 프로그램을 실행하고 이 서비스로 요청을 보내면 console에 Request, Response 로그가 출력될 것이다</p><h3 id="스프링-인터셉터-소개">스프링 인터셉터 소개</h3><p>스프링 인터셉터도 서블릿 필터와 같이 웹과 관련된 공통 관심 사항을 효과적으로 해결할 수 있는 기술이다 서블릿 필터가 서블릿의 하위 기술이라면 스프링 인터셉터는 스프링 MVC가 제공하는 기술이다</p><p>####스프링 인터셉터 흐름</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>HTTP 요청 -&gt; WAS -&gt; 필터 -&gt; 서블릿 -&gt; 스프링 인터셉터 -&gt; 컨트롤러
</pre></table></code></div></div><p>스프링 인터셉터는 스프링 MVC의 하위 기술이므로 스프링 MVC의 시작점인 디스패처 서블릿 이후에 등장한다</p><h4 id="스프링-컨테이너-제한">스프링 컨테이너 제한</h4><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>HTTP 요청 -&gt; WAS -&gt; 필터 -&gt; 서블릿 -&gt; 스프링 인터셉터 -&gt; 컨트롤러             // 인가 사용자 (로그인 Success)
HTTP 요청 -&gt; WAS -&gt; 필터 -&gt; 서블릿 -&gt; 스프링 인터셉터 -&gt; X                   // 비인가 사용자 (로그인 Fail)
</pre></table></code></div></div><h4 id="스프링-인터셉터-체인">스프링 인터셉터 체인</h4><p>스프링 인터셉터도 체인으로 구성되는데, 중간에 필터를 자유롭게 추가할 수 있다<br /> 예를 들어 로그를 남기는 인터셉터를 먼저 적용하고, 그 다음에 로그인 여부를 체크하는 인터셉터를 만들 수 있다</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>HTTP 요청 -&gt; WAS -&gt; 필터 -&gt; 서블릿 -&gt; 인터셉터1 -&gt; 인터셉터2 -&gt; 인터셉터3 -&gt; 컨트롤러        // 필터 체인
</pre></table></code></div></div><h4 id="스프링-인터셉터-인터페이스">스프링 인터셉터 인터페이스</h4><p>스프링 인터셉터를 사용하려면 HandlerInterceptor 인터페이스를 구현하면 된다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HandlerInterceptor</span> <span class="o">{</span>
    
    <span class="k">default</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                              <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                              <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{}</span>
    
    <span class="k">default</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                            <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                            <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span>
                            <span class="nd">@Nullable</span> <span class="nc">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{}</span>
    
    <span class="k">default</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                                 <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                                 <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span>
                                 <span class="nd">@Nullable</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{}</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">preHandle()</code> : 컨트롤러 호출 전(정확히는 핸들러 어댑터 호출 전)에 호출된다<li><code class="language-plaintext highlighter-rouge">postHandle()</code>: 컨트롤러 호출 후에 호출된다<li><code class="language-plaintext highlighter-rouge">aftercompletion()</code> : 뷰가 렌더링된 이후 호출된다. 오류가 발생해도 항상 호출된다 <br /><br /></ul><h3 id="스프링-인터셉터의-사용">스프링 인터셉터의 사용</h3><p>서비스 접근 로그를 남기는 필터를 작성하고 적용해 보겠다<br /> 먼저 로그 필터를 작성해 보자</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogInterceptor</span> <span class="kd">implements</span> <span class="nc">HandlerInterceptor</span><span class="o">{</span>
    <span class="k">default</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                              <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                              <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">LOG_ID</span><span class="o">,</span> <span class="n">uuid</span><span class="o">);</span>
        
        <span class="k">if</span> <span class="o">(</span><span class="n">handler</span> <span class="k">instanceof</span> <span class="nc">HandlerMethod</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">HandlerMethod</span> <span class="n">hm</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HandlerMethod</span><span class="o">)</span> <span class="n">handler</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"REQUEST [{}][{}][{}]"</span><span class="o">,</span> <span class="n">uuid</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">default</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                            <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                            <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span>
                            <span class="nd">@Nullable</span> <span class="nc">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"postHandle [{}]"</span><span class="o">,</span> <span class="n">modelAndView</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">default</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                                 <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                                 <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span>
                                 <span class="nd">@Nullable</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">logId</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="no">LOG_ID</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"RESPONSE [{}][{}]"</span><span class="o">,</span> <span class="n">logId</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"afterCompletion error!!"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>preHandle에서 등록한 값을 postHandle이나 afterCompletion에서 사용하려면 request에 담아두어야 한다 이제 작성한 인터셉터를 등록해 보자<br /> WebMvcConfigurer 인터셉터를 구현한 WebConfig 클래스를 작성했다</p><div class="language-java highlighter-rouge"><div class="code-header" text-data="java"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span><span class="o">{</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="nc">InterceptorRegistry</span> <span class="n">registry</span><span class="o">){</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="nc">LogInterceptor</span><span class="o">())</span>
                <span class="o">.</span><span class="na">order</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">"/**"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">excludePathPatterns</span><span class="o">(</span><span class="s">"/css/**"</span><span class="o">,</span> <span class="s">"/*.ico"</span><span class="o">,</span> <span class="s">"/error"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이제 프로그램을 실행하고 이 서비스로 요청을 보내면 console에 Request, Response 로그가 출력될 것이다</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/web/'>Web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/filter/" class="post-tag no-text-decoration" >filter</a> <a href="/tags/interceptor/" class="post-tag no-text-decoration" >interceptor</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor) - Koji's Blog&url=https://dvlprkoji.github.io/posts/spring-filter/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor) - Koji's Blog&u=https://dvlprkoji.github.io/posts/spring-filter/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Spring 서블릿 필터(Filter)와 스프링 인터셉터(Interceptor) - Koji's Blog&url=https://dvlprkoji.github.io/posts/spring-filter/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/spring-batch/">스프링 배치(Spring Batch) - 1. 스프링 배치 시작</a><li><a href="/posts/java-threadlocal/">자바 쓰레드 로컬(ThreadLocal)</a><li><a href="/posts/develop-oop/">객체 지향 설계 (OOP, Object Oriented Programming)</a><li><a href="/posts/spring-test/">스프링 테스트(test)</a><li><a href="/posts/dictionary/">객체 지향 설계의 5가지 원칙(OOP, Object Oriented Programming)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/batch/">batch</a> <a class="post-tag" href="/tags/comparable/">comparable</a> <a class="post-tag" href="/tags/comparator/">comparator</a> <a class="post-tag" href="/tags/servlet-container/">servlet container</a> <a class="post-tag" href="/tags/spring-container/">spring container</a> <a class="post-tag" href="/tags/spring-security/">spring security</a> <a class="post-tag" href="/tags/abstract-class/">abstract class</a> <a class="post-tag" href="/tags/abstract-method/">abstract method</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-template/"><div class="card-body"> <span class="timeago small" >Dec 1, 2021<i class="unloaded">2021-12-01T09:00:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>예제로 알아보는 스프링 템플릿(Template), 콜백(Callback)</h3><div class="text-muted small"><p> 이전에 작성했던 DB 커넥션 코드들 중 UserDao의 가장 단순한 메서드인 deleteAll()를 살펴보자 1 2 3 4 5 6 7 8 9 10 11 public class UserDao{ public void deleteAll() throws SQLException{ Connection c = dataSource.getConnect...</p></div></div></a></div><div class="card"> <a href="/posts/spring-service-abstraction/"><div class="card-body"> <span class="timeago small" >Dec 2, 2021<i class="unloaded">2021-12-02T09:00:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 서비스 추상화(Service Abstraction)</h3><div class="text-muted small"><p></p></div></div></a></div><div class="card"> <a href="/posts/spring-container/"><div class="card-body"> <span class="timeago small" >Jun 6<i class="unloaded">2023-06-06T09:00:01+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 컨테이너와 서블릿 컨테이너</h3><div class="text-muted small"><p> 웹 개발자라면 스프링 컨테이너와 서블릿 컨테이너에 대해 어느 정도는 알고 있을 것이다. 나도 딱 어느정도만 알고 있고, 실무에서 직접적으로 다루지는 않다 보니 공부를 해도 금세 휘발되어 버린다. 웹개발자라면 컨테이너, 스프링 컨테이너, 서블릿 컨테이너에 대해 언제나 설명할 수 있어야 한다고 생각하기에 정리해본다. 서블릿이란? 서블릿(Servl...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-dependency-injection/" class="btn btn-outline-primary" prompt="Older"><p>스프링 의존관계 주입 (Dependency Injection)</p></a> <a href="/posts/spring-security-1/" class="btn btn-outline-primary" prompt="Newer"><p>Spring Security (1)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/dvlprkoji">koji</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/batch/">batch</a> <a class="post-tag" href="/tags/comparable/">comparable</a> <a class="post-tag" href="/tags/comparator/">comparator</a> <a class="post-tag" href="/tags/servlet-container/">servlet container</a> <a class="post-tag" href="/tags/spring-container/">spring container</a> <a class="post-tag" href="/tags/spring-security/">spring security</a> <a class="post-tag" href="/tags/abstract-class/">abstract class</a> <a class="post-tag" href="/tags/abstract-method/">abstract method</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dvlprkoji.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
